// Enhanced mobile menu (mobile-only behavior)
const BREAKPOINT = 860;
const isMobile = () => window.innerWidth <= BREAKPOINT;

const toggle = document.getElementById('mobileToggle');
const navLinks = document.querySelector('.nav-links');

const openMenu = () => {
  toggle.setAttribute('aria-expanded', 'true');
  // mobile styles only
  navLinks.style.display = 'flex';
  navLinks.style.flexDirection = 'column';
  navLinks.style.position = 'absolute';
  navLinks.style.top = '100%';
  navLinks.style.left = '0';
  navLinks.style.right = '0';
  navLinks.style.backgroundColor = 'rgba(15, 23, 42, 0.98)';
  navLinks.style.padding = '20px 24px';
  navLinks.style.backdropFilter = 'blur(20px)';
  navLinks.style.borderTop = '1px solid rgba(255, 255, 255, 0.1)';
};

const closeMenu = () => {
  toggle.setAttribute('aria-expanded', 'false');
  // Remove inline styles so CSS controls desktop/mobile states
  navLinks.removeAttribute('style');
};

const syncMenuToViewport = () => {
  if (isMobile()) {
    // On mobile, keep closed unless explicitly opened
    if (toggle.getAttribute('aria-expanded') !== 'true') closeMenu();
  } else {
    // On desktop, ensure menu is visible and unstyled
    closeMenu();
  }
};

if (toggle && navLinks) {
  // Toggle click (mobile only)
  toggle.addEventListener('click', () => {
    if (!isMobile()) return; // ignore on desktop
    const expanded = toggle.getAttribute('aria-expanded') === 'true';
    expanded ? closeMenu() : openMenu();
  });

  // Close when clicking a nav link (mobile only)
  document.addEventListener('click', (e) => {
    if (!isMobile()) return;
    if (e.target.closest('.nav-links a') && toggle.getAttribute('aria-expanded') === 'true') {
      closeMenu();
    }
  });

  // Close when clicking outside nav (mobile only)
  document.addEventListener('click', (e) => {
    if (!isMobile()) return;
    const clickedInsideNav = e.target.closest('nav');
    if (!clickedInsideNav && toggle.getAttribute('aria-expanded') === 'true') {
      closeMenu();
    }
  });

  // Keep state correct when resizing across the breakpoint
  window.addEventListener('resize', syncMenuToViewport);
  // Initialize on load
  syncMenuToViewport();
}
